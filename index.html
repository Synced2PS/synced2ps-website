<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synced2PS | Book Your Strategy Call | Apple Gift Card Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ALL YOUR CSS STAYS EXACTLY THE SAME - NO CHANGES */
        :root {
            --primary: #0071e3;
            --primary-dark: #0056b3;
            --secondary: #1d1d1f;
            --accent: #34c759;
            --light: #f5f5f7;
            --gray: #86868b;
            --white: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
            --synced-gradient: linear-gradient(135deg, #0071e3 0%, #5856d6 100%);
        }
        /* ... (ALL CSS REMAINS EXACTLY AS YOU HAD IT) ... */
    </style>
</head>
<body>
    <!-- ALL YOUR HTML SECTIONS REMAIN EXACTLY THE SAME -->
    <!-- Header -->
    <header>
        <div class="header-container">
            <div class="logo">
                <div class="logo-icon">S2PS</div>
                <span class="logo-text">Synced2PS</span>
            </div>
            <nav class="nav-menu">
                <a href="#home">Home</a>
                <a href="#process">Process</a>
                <a href="#plans">Plans</a>
                <a href="#testimonials">Success Stories</a>
                <a href="#profit">Profit Analysis</a>
                <a href="#proof">Proof</a>
                <a href="#faq">FAQ</a>
            </nav>
            <a href="#plans" class="cta-button">Book Your Call</a>
        </div>
    </header>

    <!-- ALL SECTIONS REMAIN EXACTLY AS YOU HAD THEM -->
    <!-- ... (Hero, Process, Plans, etc.) ... -->

    <!-- Booking Modal -->
    <div class="modal-overlay" id="bookingModal">
        <!-- Modal content remains exactly the same -->
    </div>

    <!-- Confirmation Modal -->
    <div class="modal-overlay" id="appointmentConfirmationModal">
        <!-- Modal content remains exactly the same -->
    </div>

    <footer>
        <!-- Footer remains exactly the same -->
    </footer>

    <!-- FIXED FIREBASE SDK IMPORTS -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <script>
        // ==================== FIREBASE CONFIG ====================
        const firebaseConfig = {
            apiKey: "AIzaSyBy1SyiwD4QSC2T7_pOSHrhIANfgqoxqju",
            authDomain: "synced2ps.firebaseapp.com",
            projectId: "synced2ps",
            storageBucket: "synced2ps.firebasestorage.app",
            messagingSenderId: "326576247559",
            appId: "1:326576247559:web:7829337e4fef2f7504eba2"
        };

        // Initialize Firebase with error handling
        let db;
        let firebaseInitialized = false;
        
        try {
            // Check if Firebase scripts loaded
            if (typeof firebase !== 'undefined') {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                db = firebase.firestore();
                firebaseInitialized = true;
                console.log("‚úÖ Firebase initialized successfully!");
            } else {
                console.warn("‚ö†Ô∏è Firebase scripts not loaded properly");
                firebaseInitialized = false;
            }
        } catch (error) {
            console.error("‚ùå Firebase initialization failed:", error);
            firebaseInitialized = false;
        }

        // ==================== MAIN VARIABLES ====================
        let selectedPlan = '';
        let selectedPlanPrice = 0;
        let currentStep = 1;
        let contactMethod = 'phone';
        let timeDropdownOpen = false;
        
        // Real-time booked slots storage
        let realTimeBookedSlots = {};
        
        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üöÄ Website loaded - initializing...");
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('call-date');
            if (dateInput) {
                dateInput.min = today;
                dateInput.value = today;
            }
            
            // Set current year in footer
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            
            // Initialize all components
            initializeAll();
            
            // Setup hidden admin access (Ctrl+Shift+A)
            setupHiddenAdminAccess();
            
            // Load booked slots (with fallback)
            loadBookedSlots();
        });
        
        // ==================== LOAD BOOKED SLOTS WITH FIXED LOGIC ====================
        async function loadBookedSlots() {
            console.log("üì° Loading booked slots...");
            
            // Always start with local storage as fallback
            const localSlots = JSON.parse(localStorage.getItem('synced2ps_booked_slots') || '{}');
            realTimeBookedSlots = localSlots;
            
            // Try Firebase if available
            if (firebaseInitialized && db) {
                try {
                    console.log("üî• Loading from Firebase...");
                    const snapshot = await db.collection('bookedSlots').get();
                    
                    // Merge with local slots (Firebase takes priority)
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        realTimeBookedSlots[data.timeKey] = true;
                    });
                    
                    console.log(`‚úÖ Loaded ${Object.keys(realTimeBookedSlots).length} booked slots (Firebase + local)`);
                    
                } catch (error) {
                    console.error("‚ùå Error loading from Firebase, using local storage:", error);
                }
            } else {
                console.log("‚ö†Ô∏è Using local storage only (Firebase not available)");
            }
            
            // Generate time slots
            generateTimeSlots();
        }
        
        // ==================== SAVE TO FIREBASE WITH FALLBACK ====================
        async function saveBookingToFirebase(registration, timeKey) {
            if (!firebaseInitialized || !db) {
                console.warn("‚ö†Ô∏è Firebase not available, saving to local storage only");
                // Save to local storage
                const localBookings = JSON.parse(localStorage.getItem('synced2ps_bookings') || '[]');
                localBookings.push(registration);
                localStorage.setItem('synced2ps_bookings', JSON.stringify(localBookings));
                
                // Mark slot as booked in local storage
                realTimeBookedSlots[timeKey] = true;
                localStorage.setItem('synced2ps_booked_slots', JSON.stringify(realTimeBookedSlots));
                
                return { success: true, id: 'local_' + Date.now() };
            }
            
            try {
                // Save to Firebase
                const bookingRef = await db.collection('bookings').add(registration);
                
                // Mark slot as booked in Firebase
                await db.collection('bookedSlots').doc(timeKey).set({
                    timeKey: timeKey,
                    date: registration.date,
                    time: registration.time,
                    bookedAt: new Date().toISOString(),
                    bookingId: bookingRef.id,
                    bookedBy: registration.email
                });
                
                // Also update local storage for consistency
                realTimeBookedSlots[timeKey] = true;
                localStorage.setItem('synced2ps_booked_slots', JSON.stringify(realTimeBookedSlots));
                
                console.log('‚úÖ Booking saved to Firebase:', bookingRef.id);
                return { success: true, id: bookingRef.id };
                
            } catch (error) {
                console.error('‚ùå Firebase save failed:', error);
                throw error;
            }
        }
        
        // ==================== FIXED BOOKING SUBMISSION ====================
        async function submitBooking() {
            console.log("üì§ Submitting booking...");
            
            // Disable submit button to prevent double submission
            const submitBtn = document.querySelector('.btn-submit');
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Submitting...';
            }
            
            try {
                let name, email, contactInfo;
                
                if (contactMethod === 'phone') {
                    name = document.getElementById('full-name').value.trim();
                    email = document.getElementById('email').value.trim();
                    contactInfo = document.getElementById('phone').value.trim();
                } else {
                    name = document.getElementById('snapchat-name').value.trim();
                    email = document.getElementById('snapchat-email').value.trim();
                    contactInfo = document.getElementById('snapchat-username').value.trim();
                    const phone = document.getElementById('snapchat-phone').value.trim();
                    if (phone) contactInfo += ` (Phone: ${phone})`;
                }
                
                const timeKey = document.getElementById('selected-time').dataset.key;
                const date = document.getElementById('call-date').value;
                const timeDisplay = document.getElementById('selected-time').value;
                
                // Double-check slot is still available
                if (realTimeBookedSlots[timeKey]) {
                    alert('‚ö†Ô∏è This time slot was just booked by someone else. Please select another time.');
                    generateTimeSlots();
                    return;
                }
                
                const registration = {
                    plan: selectedPlan,
                    price: selectedPlanPrice,
                    contactMethod: contactMethod,
                    name: name,
                    email: email,
                    contactInfo: contactInfo,
                    country: document.getElementById('country').value,
                    date: date,
                    time: timeDisplay,
                    timeKey: timeKey,
                    timezone: document.getElementById('timezone').value || 'GMT',
                    experience: document.getElementById('experience').value,
                    goals: document.getElementById('goals').value.trim(),
                    questions: document.getElementById('questions').value.trim(),
                    timestamp: new Date().toISOString(),
                    status: 'booked'
                };
                
                // Save booking
                const result = await saveBookingToFirebase(registration, timeKey);
                
                if (result.success) {
                    // Update UI
                    document.getElementById('appointment-date-display').textContent = formatDate(date);
                    document.getElementById('appointment-time-display').textContent = timeDisplay + ' GMT';
                    
                    // Show confirmation
                    closeBookingModal();
                    setTimeout(() => {
                        document.getElementById('appointmentConfirmationModal').classList.add('active');
                        document.body.style.overflow = 'hidden';
                    }, 100);
                    
                    // Refresh time slots
                    generateTimeSlots();
                    
                    // Reset form
                    resetForm();
                }
                
            } catch (error) {
                console.error('‚ùå Booking failed:', error);
                alert('Sorry, there was an error saving your booking. Please try again.');
            } finally {
                // Re-enable submit button
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Submit Booking';
                }
            }
        }
        
        // ==================== HELPER FUNCTIONS ====================
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-GB', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }
        
        // ==================== TIME SLOT GENERATION (FIXED) ====================
        function generateTimeSlots() {
            const dateInput = document.getElementById('call-date');
            if (!dateInput) return;
            
            const selectedDate = dateInput.value;
            const today = new Date().toISOString().split('T')[0];
            const now = new Date();
            
            // Get current time in UTC/GMT
            const currentHour = now.getUTCHours();
            const currentMinute = now.getUTCMinutes();
            
            const timeDropdown = document.getElementById('timeSelectDropdown');
            const times = [];
            
            const isToday = selectedDate === today;
            
            // Generate time slots from 9 AM to 8:30 PM GMT
            for (let hour = 9; hour <= 20; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    if (hour === 20 && minute === 30) break;
                    
                    // Skip past times for today
                    if (isToday) {
                        const slotHour = hour;
                        const slotMinute = minute;
                        const nowInMinutes = currentHour * 60 + currentMinute;
                        const slotInMinutes = slotHour * 60 + slotMinute;
                        
                        // Allow booking at least 2 hours in advance
                        if (slotInMinutes < nowInMinutes + 120) {
                            continue;
                        }
                    }
                    
                    const ampm = hour >= 12 ? 'PM' : 'AM';
                    const displayHour = hour % 12 || 12;
                    const displayMinute = minute === 0 ? '00' : '30';
                    
                    const timeString = `${displayHour}:${displayMinute} ${ampm}`;
                    const timeKey = `${selectedDate}_${hour}:${minute === 0 ? '00' : '30'}`;
                    
                    // Check if slot is booked
                    const isBooked = realTimeBookedSlots[timeKey] === true;
                    
                    times.push({
                        display: timeString,
                        key: timeKey,
                        booked: isBooked
                    });
                }
            }
            
            // Generate HTML
            if (timeDropdown) {
                timeDropdown.innerHTML = times.map(time => 
                    `<div class="time-option ${time.booked ? 'booked' : ''}" 
                          ${!time.booked ? `onclick="selectTime('${time.display}', '${time.key}')"` : ''}
                          ${time.booked ? 'style="cursor: not-allowed;"' : ''}>
                        ${time.display} ${time.booked ? '(Booked)' : ''}
                    </div>`
                ).join('');
            }
        }
        
        // ==================== THE REST OF YOUR FUNCTIONS ====================
        // All other functions remain exactly the same as you had them:
        // - setupHiddenAdminAccess()
        // - showAdminLogin()
        // - initializeAll()
        // - initializeFAQ()
        // - initializeBookingButtons()
        // - setupModalCloseListeners()
        // - openBookingModal()
        // - closeBookingModal()
        // - closeAppointmentConfirmation()
        // - resetForm()
        // - selectContactMethod()
        // - selectTime()
        // - toggleTimeDropdown()
        // - closeTimeDropdown()
        // - prevStep()
        // - nextStep()
        // - validateStep1()
        // - validateStep2()
        // - validateAndSubmitBooking()
        
        // I'll include a corrected version of the key functions below:
        
        function setupHiddenAdminAccess() {
            // Ctrl+Shift+A shortcut
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                    e.preventDefault();
                    showAdminLogin();
                }
            });
        }
        
        function showAdminLogin() {
            const password = prompt("üîí Enter admin password:");
            if (password === "s2ps@S2PS@") {
                localStorage.setItem('admin_authenticated', 'true');
                window.location.href = 'admin.html';
            } else if (password) {
                alert('‚ùå Incorrect password');
            }
        }
        
        function initializeAll() {
            // Initialize FAQ
            initializeFAQ();
            
            // Initialize booking buttons
            initializeBookingButtons();
            
            // Setup modal close listeners
            setupModalCloseListeners();
            
            console.log("‚úÖ All components initialized!");
        }
        
        function initializeFAQ() {
            const faqItems = document.querySelectorAll('.faq-item');
            
            faqItems.forEach(item => {
                const question = item.querySelector('.faq-question');
                
                question.addEventListener('click', function() {
                    const isActive = item.classList.contains('active');
                    
                    // Close all others
                    faqItems.forEach(otherItem => {
                        if (otherItem !== item) {
                            otherItem.classList.remove('active');
                        }
                    });
                    
                    // Toggle current
                    if (!isActive) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
            });
        }
        
        function initializeBookingButtons() {
            document.querySelectorAll('.book-call-btn').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const plan = this.getAttribute('data-plan');
                    const price = this.getAttribute('data-price');
                    
                    openBookingModal(plan, parseInt(price));
                });
            });
        }
        
        function setupModalCloseListeners() {
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', function(e) {
                    if (e.target === this) {
                        if (this.id === 'bookingModal') {
                            closeBookingModal();
                        }
                        if (this.id === 'appointmentConfirmationModal') {
                            closeAppointmentConfirmation();
                        }
                    }
                });
            });
        }
        
        function openBookingModal(plan, price) {
            selectedPlan = plan;
            selectedPlanPrice = price;
            
            document.getElementById('plan-name-display').textContent = plan + ' Plan';
            document.getElementById('plan-price-display').textContent = price > 0 ? '¬£' + price + '/month' : 'Custom Pricing';
            
            resetForm();
            
            document.getElementById('bookingModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeBookingModal() {
            document.getElementById('bookingModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        function closeAppointmentConfirmation() {
            document.getElementById('appointmentConfirmationModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        function resetForm() {
            currentStep = 1;
            contactMethod = 'phone';
            
            document.querySelectorAll('.form-step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById('step-1').classList.add('active');
            
            // Reset contact method
            document.querySelectorAll('.contact-method-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.contact-method-btn').classList.add('active');
            document.getElementById('phone-fields').style.display = 'block';
            document.getElementById('snapchat-fields').style.display = 'none';
            
            // Clear form fields
            document.querySelectorAll('#bookingModal input, #bookingModal select, #bookingModal textarea').forEach(field => {
                if (field.id !== 'call-date' && field.type !== 'button' && field.type !== 'submit') {
                    field.value = '';
                }
            });
            
            // Clear errors
            document.querySelectorAll('.error-message').forEach(error => {
                error.classList.remove('show');
            });
            
            // Reset time selection
            document.getElementById('selectedTimeDisplay').textContent = 'Select a time';
            document.getElementById('selected-time').value = '';
            closeTimeDropdown();
            
            generateTimeSlots();
        }
        
        function selectContactMethod(method) {
            contactMethod = method;
            
            document.querySelectorAll('.contact-method-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const clickedBtn = event.target.closest('.contact-method-btn');
            if (clickedBtn) {
                clickedBtn.classList.add('active');
            }
            
            document.getElementById('phone-fields').style.display = method === 'phone' ? 'block' : 'none';
            document.getElementById('snapchat-fields').style.display = method === 'snapchat' ? 'block' : 'none';
        }
        
        function selectTime(timeDisplay, timeKey) {
            document.getElementById('selectedTimeDisplay').textContent = timeDisplay;
            const timeInput = document.getElementById('selected-time');
            timeInput.value = timeDisplay;
            timeInput.dataset.key = timeKey;
            closeTimeDropdown();
            
            document.getElementById('time-error').classList.remove('show');
        }
        
        function toggleTimeDropdown() {
            const dropdown = document.getElementById('timeSelectDropdown');
            const button = document.getElementById('timeSelectBtn');
            
            if (timeDropdownOpen) {
                dropdown.classList.remove('open');
                button.classList.remove('open');
            } else {
                dropdown.classList.add('open');
                button.classList.add('open');
            }
            
            timeDropdownOpen = !timeDropdownOpen;
        }
        
        function closeTimeDropdown() {
            const dropdown = document.getElementById('timeSelectDropdown');
            const button = document.getElementById('timeSelectBtn');
            
            dropdown.classList.remove('open');
            button.classList.remove('open');
            timeDropdownOpen = false;
        }
        
        function prevStep(step) {
            document.getElementById('step-' + step).classList.remove('active');
            currentStep = step - 1;
            document.getElementById('step-' + currentStep).classList.add('active');
        }
        
        function nextStep(step) {
            document.getElementById('step-' + step).classList.remove('active');
            currentStep = step + 1;
            document.getElementById('step-' + currentStep).classList.add('active');
        }
        
        function validateStep1() {
            let isValid = true;
            
            // Clear previous errors
            document.querySelectorAll('#step-1 .error-message').forEach(error => {
                error.classList.remove('show');
            });
            
            if (contactMethod === 'phone') {
                const name = document.getElementById('full-name').value.trim();
                if (!name) {
                    document.getElementById('name-error').textContent = 'Full name is required';
                    document.getElementById('name-error').classList.add('show');
                    isValid = false;
                }
                
                const email = document.getElementById('email').value.trim();
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!email || !emailRegex.test(email)) {
                    document.getElementById('email-error').textContent = 'Valid email is required';
                    document.getElementById('email-error').classList.add('show');
                    isValid = false;
                }
                
                const phone = document.getElementById('phone').value.trim();
                if (!phone || phone.replace(/\D/g, '').length < 8) {
                    document.getElementById('phone-error').textContent = 'Valid phone number is required';
                    document.getElementById('phone-error').classList.add('show');
                    isValid = false;
                }
            } else {
                const snapName = document.getElementById('snapchat-name').value.trim();
                if (!snapName) {
                    document.getElementById('snapchat-name-error').textContent = 'Full name is required';
                    document.getElementById('snapchat-name-error').classList.add('show');
                    isValid = false;
                }
                
                const snapEmail = document.getElementById('snapchat-email').value.trim();
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!snapEmail || !emailRegex.test(snapEmail)) {
                    document.getElementById('snapchat-email-error').textContent = 'Valid email is required';
                    document.getElementById('snapchat-email-error').classList.add('show');
                    isValid = false;
                }
                
                const snapUsername = document.getElementById('snapchat-username').value.trim();
                if (!snapUsername) {
                    document.getElementById('snapchat-username-error').textContent = 'Snapchat username is required';
                    document.getElementById('snapchat-username-error').classList.add('show');
                    isValid = false;
                }
            }
            
            const country = document.getElementById('country').value;
            if (!country) {
                document.getElementById('country-error').textContent = 'Please select your country';
                document.getElementById('country-error').classList.add('show');
                isValid = false;
            }
            
            if (isValid) {
                nextStep(1);
            }
            
            return isValid;
        }
        
        function validateStep2() {
            let isValid = true;
            
            // Clear previous errors
            document.querySelectorAll('#step-2 .error-message').forEach(error => {
                error.classList.remove('show');
            });
            
            const date = document.getElementById('call-date').value;
            const time = document.getElementById('selected-time').value;
            const timeKey = document.getElementById('selected-time').dataset.key;
            
            if (!date) {
                document.getElementById('date-error').textContent = 'Please select a date';
                document.getElementById('date-error').classList.add('show');
                isValid = false;
            }
            
            if (!time || !timeKey) {
                document.getElementById('time-error').textContent = 'Please select a time';
                document.getElementById('time-error').classList.add('show');
                isValid = false;
            } else if (realTimeBookedSlots[timeKey]) {
                document.getElementById('time-error').textContent = 'This time slot has been booked. Please select another time.';
                document.getElementById('time-error').classList.add('show');
                isValid = false;
                generateTimeSlots();
            }
            
            if (isValid) {
                nextStep(2);
            }
            
            return isValid;
        }
        
        function validateAndSubmitBooking() {
            // First validate step 1
            if (!validateStep1()) {
                // Go back to step 1 if validation fails
                document.getElementById('step-3').classList.remove('active');
                document.getElementById('step-2').classList.remove('active');
                document.getElementById('step-1').classList.add('active');
                currentStep = 1;
                return;
            }
            
            // Then validate step 2
            if (!validateStep2()) {
                // Go back to step 2 if validation fails
                document.getElementById('step-3').classList.remove('active');
                document.getElementById('step-2').classList.add('active');
                currentStep = 2;
                return;
            }
            
            // If all validations pass, submit
            submitBooking();
        }
        
        // Date change listener
        document.getElementById('call-date')?.addEventListener('change', generateTimeSlots);
        
        // Close time dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.time-select-container')) {
                closeTimeDropdown();
            }
        });
    </script>
</body>
</html>
